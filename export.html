<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>מחולל מסמכים: DOCX / PDF</title>

  <!-- עיצוב -->
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link href="https://fonts.googleapis.com/css2?family=Assistant:wght@300;400;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet"
        href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css"
        integrity="sha512-1hct0h9FvH8Qk2p0K8J3K6c9s3TqQm7tCq4a9n4mE9lG0Wwz0qk4O1S8i8qf8Z1O7H8m2iN3m0+0u0yqFh8P8w=="
        crossorigin="anonymous" referrerpolicy="no-referrer" />

  <!-- יוצר DOCX -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/docx/8.5.0/docx.umd.min.js"></script>
  <!-- שמירת קבצים -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js"></script>
  <!-- יוצר PDF מ-HTML (טוב לעברית ו-RTL) -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>

  <style>
    :root {
      --bg: #0f172a;           /* slate-900 */
      --panel: rgba(255,255,255,0.06);
      --panel-border: rgba(255,255,255,0.14);
      --accent: #22d3ee;       /* cyan-400 */
      --accent-2: #a78bfa;     /* violet-400 */
    }
    body { font-family: 'Assistant', system-ui, -apple-system, Segoe UI, Roboto, sans-serif; background: radial-gradient(1200px 600px at 80% -10%, rgba(34,211,238,0.10), transparent 60%), radial-gradient(1000px 500px at -10% 120%, rgba(167,139,250,0.10), transparent 60%), var(--bg); }
    .glass {
      background: var(--panel);
      backdrop-filter: blur(10px);
      border: 1px solid var(--panel-border);
    }
    /* ל־PDF: לשמר שורות כמו בתיבה */
    #pdf-preview { white-space: pre-wrap; direction: rtl; text-align: right; }
  </style>
</head>
<body class="min-h-screen text-white selection:bg-cyan-300/40">
  <header class="px-6 pt-10 pb-6 text-center">
    <h1 class="text-3xl md:text-4xl font-bold tracking-tight">
      מחולל מסמכים מהיר <span class="text-cyan-300">DOCX</span> / <span class="text-violet-300">PDF</span>
    </h1>
    <p class="mt-2 text-white/70">כתבו טקסט, בחרו פורמט, והורידו – הכל בדפדפן, עם תמיכה מלאה בעברית.</p>
  </header>

  <main class="max-w-4xl mx-auto px-4 pb-16">
    <section class="glass rounded-2xl p-5 md:p-7">
      <div class="grid gap-4 md:gap-5">
        <div class="grid md:grid-cols-5 gap-3 items-center">
          <label for="docTitle" class="md:col-span-1 font-semibold">כותרת המסמך</label>
          <input id="docTitle" type="text" inputmode="text" placeholder="למשל: סיכום טיול / רשימת משימות"
                 class="md:col-span-4 w-full rounded-xl bg-white/5 border border-white/10 px-4 py-3 focus:outline-none focus:ring-2 focus:ring-cyan-400 placeholder-white/40">
        </div>

        <div class="grid md:grid-cols-5 gap-3">
          <label for="docText" class="md:col-span-1 font-semibold mt-2">תוכן</label>
          <textarea id="docText" rows="10" placeholder="כתבו כאן את הטקסט שלכם... (תומך בשורות מרובות)"
                    class="md:col-span-4 w-full rounded-xl bg-white/5 border border-white/10 px-4 py-3 focus:outline-none focus:ring-2 focus:ring-violet-400 placeholder-white/40"></textarea>
        </div>

        <div class="flex flex-wrap gap-3 justify-end pt-2">
          <button id="btnDocx"
                  class="inline-flex items-center gap-2 rounded-xl px-4 py-3 bg-cyan-500/90 hover:bg-cyan-400 transition font-semibold">
            <i class="fa-regular fa-file-word"></i>
            צור DOCX
          </button>
          <button id="btnPdf"
                  class="inline-flex items-center gap-2 rounded-xl px-4 py-3 bg-violet-500/90 hover:bg-violet-400 transition font-semibold">
            <i class="fa-regular fa-file-pdf"></i>
            צור PDF
          </button>
        </div>

        <!-- תיבה נסתרת לייצוא PDF מ-HTML (html2pdf מטפל יפה בעברית/RTL) -->
        <div id="pdf-preview" class="hidden glass rounded-xl p-6 leading-8 text-[15px]"></div>

        <!-- טוסט התראה קטן -->
        <div id="toast" class="fixed bottom-6 right-6 left-6 md:left-auto z-50 hidden">
          <div class="glass rounded-xl px-4 py-3 flex items-center gap-3">
            <i class="fa-solid fa-circle-check text-emerald-300"></i>
            <span id="toast-text" class="text-sm"></span>
          </div>
        </div>
      </div>
    </section>

    <section class="mt-6 text-xs text-white/60 text-center">
      טיפ: לשמירה על שורות, פשוט עברו שורה בתיבה. ה־PDF ישמור על מבנה הטקסט, וה־DOCX יפתח יפה בוורד.
    </section>
  </main>

  <script>
    // ===== עזר: טוסט =====
    function showToast(msg, ms = 2200) {
      const el = document.getElementById('toast');
      const txt = document.getElementById('toast-text');
      txt.textContent = msg;
      el.classList.remove('hidden');
      setTimeout(() => el.classList.add('hidden'), ms);
    }

    // ===== עזר: שם קובץ נוח =====
    function filenameFromTitle(ext) {
      const title = (document.getElementById('docTitle').value || 'מסמך ללא כותרת').trim();
      const safe = title.replace(/[\\\/:*?"<>|]+/g, ' ').replace(/\s+/g, ' ').trim();
      const stamp = new Date().toISOString().slice(0,19).replace(/[:T]/g,'-');
      return (safe || 'document') + ' - ' + stamp + '.' + ext;
    }

    // ===== יצירת DOCX עם הספרייה docx =====
    async function createDocx() {
      const text = document.getElementById('docText').value;
      if (!text.trim()) { showToast('אין תוכן. כתבו משהו בתיבה קודם.'); return; }

      const { Document, Packer, Paragraph, TextRun, AlignmentType } = window.docx;

      // הופכים כל שורה לפסקה, עם RTL (bidirectional) ויישור לימין
      const paragraphs = text.split(/\r?\n/).map(line =>
        new Paragraph({
          bidirectional: true,
          alignment: AlignmentType.RIGHT,
          children: [
            new TextRun({ text: line.length ? line : ' ', font: 'Assistant' })
          ]
        })
      );

      const title = (document.getElementById('docTitle').value || '').trim();
      const sectionChildren = [];

      if (title) {
        sectionChildren.push(
          new Paragraph({
            bidirectional: true,
            alignment: AlignmentType.RIGHT,
            children: [
              new TextRun({ text: title, bold: true, size: 32 }) // ~16pt
            ],
            spacing: { after: 200 }
          })
        );
      }
      sectionChildren.push(...paragraphs);

      const doc = new Document({
        sections: [{
          properties: {
            page: {
              margin: { top: 720, right: 720, bottom: 720, left: 720 } // 1 אינץ' = 720
            }
          },
          children: sectionChildren
        }]
      });

      const blob = await Packer.toBlob(doc);
      saveAs(blob, filenameFromTitle('docx'));
      showToast('DOCX נוצר והורד בהצלחה!');
    }

    // ===== יצירת PDF (html2pdf – תומך יפה בעברית/RTL) =====
    function createPdf() {
      const text = document.getElementById('docText').value;
      if (!text.trim()) { showToast('אין תוכן. כתבו משהו בתיבה קודם.'); return; }

      const title = (document.getElementById('docTitle').value || '').trim();
      const preview = document.getElementById('pdf-preview');

      // בונים HTML פשוט ליצוא – שומר RTL ושבירת שורות
      const header = title ? `<h1 style="margin:0 0 10px; font-weight:700; font-size:20px; text-align:right;">${escapeHtml(title)}</h1>` : '';
      preview.innerHTML = `${header}<div>${escapeHtml(text)}</div>`;

      // מראים זמנית כדי שהמנוע יחשב גדלים נכון (אך שומרים שזה "שקוף" ובלי קפיצות)
      preview.classList.remove('hidden');

      const opt = {
        filename: filenameFromTitle('pdf'),
        margin: [15, 15, 15, 15], // pt
        image: { type: 'jpeg', quality: 0.98 },
        html2canvas: { scale: 2, useCORS: true },
        jsPDF: { unit: 'pt', format: 'a4', orientation: 'portrait' }
      };

      html2pdf().set(opt).from(preview).save()
        .then(() => showToast('PDF נוצר והורד בהצלחה!'))
        .finally(() => preview.classList.add('hidden'));
    }

    // הגנת XSS פשוטה לתוכן שמוזרם ל־innerHTML
    function escapeHtml(str) {
      return String(str)
        .replaceAll('&','&amp;')
        .replaceAll('<','&lt;')
        .replaceAll('>','&gt;')
        .replaceAll('"','&quot;')
        .replaceAll("'", '&#39;')
        .replace(/\r?\n/g, '\n'); // נשמר; #pdf-preview מוגדר עם white-space: pre-wrap
    }

    // ===== חיבור כפתורים =====
    document.getElementById('btnDocx').addEventListener('click', createDocx);
    document.getElementById('btnPdf').addEventListener('click', createPdf);

    // מקשי קיצור נחמדים: Ctrl/Cmd+Enter -> PDF, Ctrl/Cmd+S -> DOCX
    document.addEventListener('keydown', (e) => {
      if ((e.ctrlKey || e.metaKey) && e.key.toLowerCase() === 's') {
        e.preventDefault();
        createDocx();
      } else if ((e.ctrlKey || e.metaKey) && e.key === 'Enter') {
        e.preventDefault();
        createPdf();
      }
    });
  </script>
</body>
</html>