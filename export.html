<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>מחולל מסמכים: Docs / PDF / Word</title>

  <!-- Tailwind + Font -->
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Assistant:wght@300;400;600;700&display=swap" rel="stylesheet">

  <!-- Icons -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css"/>

  <!-- jsPDF (PDF) -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

  <!-- html2canvas (לרינדור HTML ל-PDF אם תרצה לשדרג בהמשך) -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>

  <!-- Word (.docx) -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js"></script>
  <!-- docx UMD (ספריית docx הרשמית) -->
  <script src="https://cdn.jsdelivr.net/npm/docx@9.5.1/build/index.umd.js"></script>

  <!-- Google APIs (לכפתור Docs) -->
  <script async defer src="https://apis.google.com/js/api.js"></script>
  <script async defer src="https://accounts.google.com/gsi/client"></script>

  <style>
    :root{
      --bg1:#0f172a; /* slate-900 */
      --card: rgba(255,255,255,0.06);
      --card-border: rgba(255,255,255,0.16);
    }
    body{ font-family: 'Assistant', system-ui, -apple-system, Segoe UI, sans-serif; }
    .glass{
      background: var(--card);
      backdrop-filter: blur(10px);
      border: 1px solid var(--card-border);
    }
    .gradient{
      background: radial-gradient(1200px 500px at 80% -10%, rgba(59,130,246,0.25), transparent 60%),
                  radial-gradient(900px 500px at -10% 100%, rgba(16,185,129,0.20), transparent 60%),
                  linear-gradient(180deg, #0b1220 0%, #0f172a 60%, #0b1220 100%);
      min-height: 100svh;
    }
    textarea{
      resize: vertical;
    }
    .hint small{ opacity:.8 }
  </style>
</head>
<body class="gradient text-slate-100">
  <header class="max-w-5xl mx-auto px-4 pt-8 pb-4">
    <h1 class="text-3xl md:text-4xl font-bold tracking-tight">
      מחולל מסמכים — כתוב טקסט ולחץ על הכפתור המתאים
    </h1>
    <p class="text-slate-300 mt-1">Google Docs / PDF / Word (.docx)</p>
  </header>

  <main class="max-w-5xl mx-auto px-4 pb-16">
    <section class="glass rounded-2xl p-5 md:p-8">
      <div class="grid md:grid-cols-3 gap-6">
        <div class="md:col-span-2 space-y-4">
          <label class="block">
            <span class="block mb-1 text-sm text-slate-300">כותרת (לא חובה)</span>
            <input id="title" type="text" class="w-full rounded-xl border border-slate-600/50 bg-slate-800/40 px-4 py-3 outline-none focus:ring-2 focus:ring-blue-500" placeholder="כותרת המסמך...">
          </label>

          <label class="block">
            <span class="block mb-1 text-sm text-slate-300">הטקסט שלך</span>
            <textarea id="content" rows="10" class="w-full rounded-xl border border-slate-600/50 bg-slate-800/40 px-4 py-3 outline-none focus:ring-2 focus:ring-blue-500" placeholder="הדבק או כתוב כאן את התוכן..."></textarea>
          </label>

          <div class="flex flex-wrap gap-3 pt-2">
            <button id="btnDocs" class="inline-flex items-center gap-2 rounded-xl bg-blue-600 hover:bg-blue-500 px-5 py-3 font-semibold">
              <i class="fa-brands fa-google-drive"></i> צור Google Docs
            </button>
            <button id="btnPdf" class="inline-flex items-center gap-2 rounded-xl bg-emerald-600 hover:bg-emerald-500 px-5 py-3 font-semibold">
              <i class="fa-regular fa-file-pdf"></i> צור PDF
            </button>
            <button id="btnDocx" class="inline-flex items-center gap-2 rounded-xl bg-fuchsia-600 hover:bg-fuchsia-500 px-5 py-3 font-semibold">
              <i class="fa-regular fa-file-word"></i> צור Word (.docx)
            </button>
          </div>

          <p class="hint text-slate-400 text-sm">
            טיפ: ל־PDF עברי חלק כדאי להשתמש בפונט יוניקוד מוטמע. הפתרון כאן עובד מצוין לטקסטים פשוטים;
            ניתן לשדרג לשימוש ברינדור HTML מלא (html2canvas+jsPDF) לפי הצורך.
          </p>
        </div>

        <aside class="space-y-4">
          <div class="rounded-xl border border-slate-700/50 p-4">
            <h3 class="font-semibold mb-2">התקנה לכפתור Google Docs</h3>
            <ol class="list-decimal pr-5 space-y-1 text-sm text-slate-300">
              <li>ב־Google Cloud Console: הפעל את <strong>Docs API</strong> (ואפשרי גם <strong>Drive API</strong>).</li>
              <li>צור <strong>API Key</strong> ו־<strong>OAuth Client ID — Web</strong> (עם דומיין שלך/localhost).</li>
              <li>הדבק למטה ב־<code>CONFIG</code> את ה־CLIENT_ID וה־API_KEY שלך.</li>
              <li>שמור ופתח מ־HTTPS. לחיצה על “צור Google Docs” תפתח מסמך חדש אוטומטית.</li>
            </ol>
            <p class="text-xs mt-2 text-slate-400">Docs נוצרים ריקים ואז מקבלים טקסט עם <code>documents.batchUpdate</code>. נדרשות הרשאות <code>documents</code> ו/או <code>drive.file</code>.  [oai_citation:1‡Google for Developers](https://developers.google.com/workspace/docs/api/reference/rest/v1/documents/batchUpdate)</p>
          </div>

          <div class="rounded-xl border border-slate-700/50 p-4">
            <h3 class="font-semibold mb-2">מה כל כפתור עושה?</h3>
            <ul class="list-disc pr-5 text-sm text-slate-300 space-y-1">
              <li><b>Google Docs</b>: יצירה ב־Google Docs ישירות בחשבון שלך (OAuth).  [oai_citation:2‡Google for Developers](https://developers.google.com/workspace/docs/api/quickstart/js?utm_source=chatgpt.com)</li>
              <li><b>PDF</b>: יצירת PDF מקומית עם jsPDF (עטיפת שורות וכו').  [oai_citation:3‡cdnjs](https://cdnjs.com/libraries/jspdf?utm_source=chatgpt.com)</li>
              <li><b>Word (.docx)</b>: יצירת קובץ .docx בדפדפן עם ספריית <code>docx</code>; כולל תמיכה באופציית bidi לפסקאות RTL.  [oai_citation:4‡NPM](https://www.npmjs.com/package/docx?utm_source=chatgpt.com) [oai_citation:5‡docx.js.org](https://docx.js.org/api/types/IParagraphPropertiesOptions.html?utm_source=chatgpt.com)</li>
            </ul>
          </div>
        </aside>
      </div>
    </section>

    <section class="mt-6 text-xs text-slate-400">
      <p>נבנה עם ספריות פתוחות: Google Docs API + Google Identity Services, jsPDF, docx.</p>
    </section>
  </main>

  <script>
    // ========================
    //   הגדרות כלליות
    // ========================
    const CONFIG = {
      CLIENT_ID: "PASTE_YOUR_GOOGLE_OAUTH_CLIENT_ID.apps.googleusercontent.com",
      API_KEY:   "PASTE_YOUR_GOOGLE_API_KEY"
    };

    const SCOPES = "https://www.googleapis.com/auth/documents https://www.googleapis.com/auth/drive.file"; // הרשאות מומלצות לכתיבה למסמכים שנוצרים על ידי האפליקציה.  [oai_citation:6‡Google for Developers](https://developers.google.com/workspace/docs/api/reference/rest/v1/documents/batchUpdate)
    const DISCOVERY_DOCS = ["https://docs.googleapis.com/$discovery/rest?version=v1"]; // טוען את Docs API.  [oai_citation:7‡גוגל](https://google.github.io/google-api-javascript-client/docs/start.html?utm_source=chatgpt.com)

    const $ = (sel) => document.querySelector(sel);
    const getTitle = () =>
      ($("#title").value || `מסמך חדש — ${new Date().toLocaleDateString('he-IL')}`).trim();
    const getText  = () => ($("#content").value || "").replace(/\r\n/g, "\n");

    // ========================
    //   Google Docs (OAuth)
    // ========================
    let gapiInited = false;
    let tokenClient = null;

    async function ensureGapiLoaded(){
      if (gapiInited) return;
      await new Promise(resolve => {
        gapi.load('client', async () => {
          await gapi.client.init({ apiKey: CONFIG.API_KEY, discoveryDocs: DISCOVERY_DOCS });
          gapiInited = true;
          resolve();
        });
      });
    }

    function getAccessToken(){
      return new Promise((resolve, reject) => {
        if (!tokenClient){
          tokenClient = google.accounts.oauth2.initTokenClient({
            client_id: CONFIG.CLIENT_ID,
            scope: SCOPES,
            callback: (resp) => {
              if (resp && resp.access_token){
                gapi.client.setToken({ access_token: resp.access_token });
                resolve(resp.access_token);
              } else {
                reject(new Error("OAuth: no access token"));
              }
            }
          });
        }
        tokenClient.requestAccessToken({ prompt: "" }); // נסה שקט; אם צריך — ייפתח חלון הרשאה.  [oai_citation:8‡Google for Developers](https://developers.google.com/identity/oauth2/web/guides/use-token-model?utm_source=chatgpt.com)
      });
    }

    async function createGoogleDoc(){
      const title = getTitle();
      const text  = getText();
      if (!text){
        alert("כתוב קצת טקסט לפני יצירת המסמך 🙂");
        return;
      }
      if (CONFIG.CLIENT_ID.startsWith("PASTE_") || CONFIG.API_KEY.startsWith("PASTE_")){
        alert("מלא/י CLIENT_ID ו-API_KEY ב-CONFIG כדי להשתמש בכפתור Google Docs.");
        return;
      }

      try{
        await ensureGapiLoaded();
        await getAccessToken();

        // 1) יצירת מסמך ריק:
        const createRes = await gapi.client.docs.documents.create({ title }); // יוצרת מסמך ריק.  [oai_citation:9‡Google for Developers](https://developers.google.com/workspace/docs/api/reference/rest/v1/documents/create?utm_source=chatgpt.com)
        const docId = createRes.result.documentId;

        // 2) הזרקת הטקסט לסוף הגוף:
        await gapi.client.docs.documents.batchUpdate({
          documentId: docId,
          resource: {
            requests: [
              // Insert at end-of-body:
              { insertText: { text, endOfSegmentLocation: {} } } // שימוש ב-EndOfSegmentLocation כדי לכתוב לסוף.  [oai_citation:10‡Google for Developers](https://developers.google.com/workspace/docs/api/reference/rest/v1/documents/batchUpdate)
            ]
          }
        });

        // 3) פתיחת המסמך בלשונית חדשה
        window.open(`https://docs.google.com/document/d/${docId}/edit`, "_blank");
      }catch(err){
        console.error(err);
        alert("ארעה שגיאה ביצירת Google Doc. בדוק הרשאות וכתובת מקור (HTTPS/דומיין מותר).");
      }
    }

    // ========================
    //   PDF עם jsPDF
    // ========================
    function createPdf(){
      const text = getText();
      if (!text){ alert("אין מה לייצא — כתוב/י טקסט תחילה."); return; }
      const title = getTitle();

      const { jsPDF } = window.jspdf; // UMD export.  [oai_citation:11‡cdnjs](https://cdnjs.com/libraries/jspdf?utm_source=chatgpt.com)
      const doc = new jsPDF({ unit: "pt", format: "a4", compress: true });

      const margin = 56;
      const pageW = doc.internal.pageSize.getWidth();
      const pageH = doc.internal.pageSize.getHeight();

      // כותרת
      doc.setFont("helvetica", "bold");
      doc.setFontSize(18);
      doc.text(title, pageW - margin, margin, { align: "right" });

      // גוף הטקסט
      doc.setFont("helvetica", "normal");
      doc.setFontSize(12);

      const maxW = pageW - margin * 2;
      const lines = doc.splitTextToSize(text, maxW); // עטיפת שורות.  [oai_citation:12‡cdnjs](https://cdnjs.com/libraries/jspdf?utm_source=chatgpt.com)
      let y = margin + 24;
      const lh = 16;

      lines.forEach(line => {
        if (y > pageH - margin){
          doc.addPage();
          y = margin;
        }
        // יישור לימין יעבוד טוב לטקסט עברי פשוט
        doc.text(line, pageW - margin, y, { align: "right" });
        y += lh;
      });

      doc.save(safeFileName(title) + ".pdf");
    }

    // ========================
    //   Word (.docx) עם 'docx'
    // ========================
    function createDocx(){
      const text = getText();
      if (!text){ alert("אין מה לייצא — כתוב/י טקסט תחילה."); return; }
      const title = getTitle();

      // window.docx הוא UMD namespace
      const { Document, Packer, Paragraph, TextRun, HeadingLevel, AlignmentType } = window.docx;

      const titlePara = new Paragraph({
        alignment: AlignmentType.RIGHT,
        bidirectional: true, // תמיכה ב־RTL ברמת פסקה.  [oai_citation:13‡docx.js.org](https://docx.js.org/api/types/IParagraphPropertiesOptions.html?utm_source=chatgpt.com)
        children: [ new TextRun({ text: title, bold: true }) ]
      });

      const bodyParas = text.split(/\r?\n/).map(line => new Paragraph({
        alignment: AlignmentType.RIGHT,
        bidirectional: true, // RTL
        children: [ new TextRun({ text: line }) ]
      }));

      const doc = new Document({
        sections: [
          {
            properties: {},
            children: [ titlePara, ...bodyParas ]
          }
        ]
      });

      Packer.toBlob(doc).then(blob => {
        saveAs(blob, safeFileName(title) + ".docx");
      });
    }

    function safeFileName(s){
      return s.replace(/[\\/:*?"<>|]+/g, "-").slice(0, 80);
    }

    // ========================
    //   אירועים
    // ========================
    window.addEventListener("DOMContentLoaded", () => {
      $("#btnDocs").addEventListener("click", createGoogleDoc);
      $("#btnPdf").addEventListener("click", createPdf);
      $("#btnDocx").addEventListener("click", createDocx);
    });
  </script>
</body>
</html>